# 渡一学习



## 实现标签页打开控制

BroadcastChannel只支持同源页面

```javascript
const channel = new BroadcastChannel("music")
channel.postMessage({
    musicName:'只因你太美'
})


另一个页面  频道名要一样music
const channel = new BroadcastChannel("music")

channel.addEventListener('message',(e)=>{
    console.log(e.data.musicName)
})

封装
function createChannel(name){
    const channel = new BroadcastChannel(name)
    channel.id = createId(name);
    channel.listeners = new Set();
    channel.addEventListener('message',(e)=>{
       if(e.data.msg === 'coming'){
           channel.listeners.add(e.data.id)
       }
       if(e.data.msg === 'leave'){
           channel.listeners.remove(e.data.id)
       }
    });
    window.addEventListener("upload",function(){
         sendMag('leave',channel);
    })
    sendMag('coming',channel);
    return channel;
}
function createId(name){
    const key = "channel-name";
    let id = +localStorage.getItem(key);
    if(!id){ id = 0 }
    id++
    localStorage.setItem(key,id.toSting())
    return id
}
function sendMsg(msg,channel){
    channel.postMessage({ msg ,id:channel.id})
}

// 使用
const channel=createChannel('music')
if(channel.listeners.size ===0){
    window.open()
}else{
    channel.postMessage({
        msg:''
    })
}
```





## HTMLCollection NodeList

HTMLCollection  ：getElementByTagName  getElementById   

NodeList ： querySelector

HTMLCollection  会实时变动，遍历过程中假如追加会死循环

NodeList 记录的是快照